<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script async type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-sv0slik/5O0JIPdLBCR2A3XDg/1U3WuDEheZfI/DI5n8Yqc3h5kjrnr46FGBNiUAJF7rE4LHKwQ/SoSLRKAxEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

{%include "components/calloutScript.njk"%}

<script async src="https://fastly.jsdelivr.net/npm/force-graph@1.43.0/dist/force-graph.min.js"></script>

<script async src="https://fastly.jsdelivr.net/npm/@alpinejs/persist@3.11.1/dist/cdn.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js" async></script>

<style>
/* Modern Language Switcher â€“ 2025 Fluent UI Style */
.language-switcher {
  position: fixed;
  top: 16px;
  right: 24px;
  z-index: 10000;
  display: flex;
  gap: 8px;
  background: rgba(255, 255, 255, 0.9); /* Light mode fallback */
  backdrop-filter: blur(20px);
  padding: 8px 16px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.language-switcher button {
  padding: 6px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

.language-switcher button:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 102, 255, 0.3);
}

.language-switcher button.active {
  background: linear-gradient(135deg, #0066ff, #1e40af);
  color: white;
  box-shadow: 0 0 0 0 rgba(0, 102, 255, 0.4);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 102, 255, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(0, 102, 255, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 102, 255, 0); }
}

.language-switcher button:not(.active) {
  background: transparent;
  color: #374151;
}

.language-switcher button:not(.active):hover {
  background: #f3f4f6;
  color: #111827;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .language-switcher {
    background: rgba(17, 24, 39, 0.9);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.2);
  }
  .language-switcher button:not(.active) {
    color: #d1d5db;
  }
  .language-switcher button:not(.active):hover {
    background: #374151;
    color: #f9fafb;
  }
}

/* Translation banner (shows if no Uzbek file) */
.translation-banner {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: #fef3c7;
  color: #92400e;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 14px;
  z-index: 9999;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}
</style>

<script>
// Fixed 2025 Language Switcher: Proper Redirect + Modern UI
// Supports: English filenames, Uzbek content files, auto-fallback
document.addEventListener("DOMContentLoaded", async () => {
  const supportedLangs = { en: "EN", uz: "UZ" }; // Add more: { de: "DE", fr: "FR" }
  const defaultLang = "en";
  const currentPath = window.location.pathname;
  const noteSlug = currentPath.split("/").pop().replace(".html", ""); // e.g., "overview-en"

  // Get lang from URL: ?lang=uz
  const params = new URLSearchParams(window.location.search);
  let currentLang = params.get("lang") || defaultLang;

  // 1. Create modern switcher buttons
  const switcher = document.createElement("div");
  switcher.className = "language-switcher";
  Object.entries(supportedLangs).forEach(([code, label]) => {
    const btn = document.createElement("button");
    btn.textContent = label;
    btn.className = code === currentLang ? "active" : "";
    btn.onclick = () => switchToLang(code);
    switcher.appendChild(btn);
  });
  document.body.appendChild(switcher);

  // 2. Core function: Switch language with redirect
  async function switchToLang(lang) {
    if (lang === defaultLang) {
      // Clean URL for English
      window.location.href = currentPath.replace(`-${lang}.html`, "-en.html") || `${currentPath.replace(".html", "-en.html")}.html`;
      return;
    }

    // For Uzbek: Check if -uz.html exists
    const uzPath = currentPath.replace(`-${defaultLang}.html`, `-${lang}.html`) || `${currentPath.replace(".html", `-${lang}.html`)}.html`;
    try {
      const response = await fetch(uzPath, { method: "HEAD" });
      if (response.ok) {
        // Redirect to clean Uzbek URL (no ?lang param)
        window.location.href = uzPath;
      } else {
        // Fallback: Show banner, stay on English
        showTranslationBanner();
      }
    } catch (error) {
      showTranslationBanner();
    }
  }

  // 3. On load: Auto-redirect if ?lang=uz and file exists
  if (currentLang !== defaultLang) {
    const targetPath = currentPath.replace(`-${defaultLang}.html`, `-${currentLang}.html`) || `${currentPath.replace(".html", `-${currentLang}.html`)}.html`;
    try {
      const response = await fetch(targetPath, { method: "HEAD" });
      if (response.ok) {
        window.location.href = targetPath; // Clean redirect
      } else {
        // Strip param, stay on English
        window.location.href = currentPath;
      }
    } catch (error) {
      window.location.href = currentPath; // Fallback to English
    }
  }

  // 4. Helper: Show "Translation coming soon" banner
  function showTranslationBanner() {
    if (document.querySelector(".translation-banner")) return;
    const banner = document.createElement("div");
    banner.className = "translation-banner";
    banner.innerHTML = `ðŸ¤” Tarjima tez orada tayyor bo'ladi! (Translation coming soon!)`;
    document.body.appendChild(banner);
    setTimeout(() => banner.remove(), 5000); // Auto-hide after 5s
  }

  // 5. Bonus: Update page title with dg-metatitle for Uzbek UI (sidebar stays smart)
  if (currentLang === "uz") {
    const metaTitle = document.querySelector('meta[property="og:title"]')?.content || document.title;
    if (metaTitle && metaTitle.includes("Umumiy")) { // Detect Uzbek via keyword
      document.title = metaTitle;
    }
    // Quick sidebar title swap (if plugin uses .tree-item classes)
    document.querySelectorAll(".tree-item-self .tree-item-inner a").forEach(link => {
      const uzTitle = link.getAttribute("data-title-uz") || link.textContent.replace("Overview", "Umumiy ko'rinish");
      if (uzTitle !== link.textContent) link.textContent = uzTitle;
    });
  }
});
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" async/>
<script src="https://fastly.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer" async></script>

<link href="/styles/digital-garden-base.css" rel="stylesheet">
{%-if meta.themeStyle%}
    <link href="/styles/obsidian-base.css" rel="stylesheet">
    <link href="{{meta.themeStyle}}" rel="stylesheet">
{% else %}
    <link href="/styles/style.css" rel="stylesheet">
{%endif%}

<link href="/styles/custom-style.css" rel="stylesheet">
{%- for style in dynamics.styles -%}
<link href="{{style}}" rel="stylesheet">
{%- endfor -%}

{% favicons './src/site/favicon.svg', appleIconBgColor='#123' %}

{% if metatags %}
    {% for name, content in metatags %}
        <meta name="{{ name }}" content="{{ content }}">
    {% endfor %}
{% endif %}

{% if meta.styleSettingsCss %}
    <style>
        {{ meta.styleSettingsCss | safe }}
    </style>
{% endif %}
<style>
</style>
